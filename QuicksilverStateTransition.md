# Quicksilver

### Таблица переходов основных состояний
|Текущее состояние|Условие перехода|Следующее состояние|
|--|--|--|
|Запуск|VideoStore.playerClick() -> VideoStore.startPreroll()|Реклама|
|Реклама|AdvRenderMixin.returnToVideo() -> VideoStore.playerClick()|Контент|
||AdvRenderMixin.playNextAdv()|Реклама|
|Контент|VideoStore.checkAdvMarks()|Реклама|
||VideoStore.handleEndScreen()|Эндскрин|
||VideoStore.showErrorScreen()|Ошибка|
|Эндскрин|VideoStore.openEndscreenAfterRestrictCheck() -> CoreStore.reinitialize()|Контент|
|Ошибка|Сохранить лог|-|
|Ошибка|Переход на ask|-|

Начальное состояние: Запуск

### Таблица переходов состояний контента
|Текущее состояние|Условие перехода|Следующее состояние|
|--|--|--|
|Запуск|VideoStore.playerClick() -> VideoStore.startPreroll()|Реклама|
||Ошибка запроса к легкому|Ошибка|
||Только дрм контент в браузере без его поддержки|Ошибка|
|Реклама|AdvRenderMixin.returnToVideo() -> VideoStore.setVideoSource(); VideoStore.playerClick()|Смена контента|
|Смена контента|Установка src/старт dash-плеера|Буферизация|
|Буферизация|Нативная загрузка фрагментов видео/Загрузка фрагментов до 4с для dash-плеера|Проигрывание|
|Проигрывание||Буферизация|
|||Адаптация|
||VideoStore.playerClick()|Пауза|
||VideoStore.progressClick() -> VideoStore.changeCurrentTime()|Перемотка|
||VideoStore.timeUpdate() -> VideoStore.checkAdvMarks()|Реклама|
|||Ошибка|
|||Эндскрин|
|Пауза|--|--|
|Перемотка|--|--|
|Реклама|--|--|
|Адаптация|--|--|
|Ошибка|--|--|
|Эндскрин|--|--|
|--|--|--|--|

### Таблица переходов состояний рекламы
|Текущее состояние|Условие перехода|Следующее состояние|
|--|--|--|

### Список состояний
|Состояние|Описание|
|-|-|
|Запуск|Html5Player.run(): Инициализация основных сервисов и классов; Запрос к mapi на список категорий и стран; Рендер интерфейса и видео-тега; Инициализация видео-сервиса (fps, video); Запрос к легкому; Выбор качества; Запрос сохраненного времени; Автоплей/Старт видео;|
|||


